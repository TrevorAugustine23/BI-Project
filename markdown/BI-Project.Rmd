---
title: "Business Intelligence Project"
author: "Trevor Okinda"
date: "27th November 2023"
output:
  github_document: 
    toc: yes
    toc_depth: 4
    fig_width: 6
    fig_height: 4
    df_print: default
editor_options:
  chunk_output_type: console
---

# Student Details

|                                              |     |
|----------------------------------------------|-----|
| **Student ID Number**                        | 134780 |
| **Student Name**                             | Trevor Okinda |
| **BBIT 4.2 Group**                           | C |
| **BI Project Group Name/ID (if applicable)** | A Rainfall prediction model with Random Trees |

# Setup Chunk

**Note:** the following KnitR options have been set as the global defaults: <BR> `knitr::opts_chunk$set(echo = TRUE, warning = FALSE, eval = TRUE, collapse = FALSE, tidy = TRUE)`.

More KnitR options are documented here <https://bookdown.org/yihui/rmarkdown-cookbook/chunk-options.html> and here <https://yihui.org/knitr/options/>.

```{r setup, include=FALSE}
library(formatR)
knitr::opts_chunk$set(
  warning = FALSE,
  collapse = FALSE
)
```

# Understanding the Dataset (Exploratory Data Analysis (EDA))

## Loading the Dataset

### Source: 

The dataset that was used can be downloaded here: *\<provide a link\>*

### Reference:

*\<Cite the dataset here using APA\>\
Refer to the APA 7th edition manual for rules on how to cite datasets: <https://apastyle.apa.org/style-grammar-guidelines/references/examples/data-set-references>*

```{r Load datasetr}
library(readr)
WeatherData <- read.csv("weather.csv", colClasses = c(
  MinTemp = "numeric",
  MaxTemp = "numeric",
  Rainfall = "numeric",
  Evaporation = "numeric",
  Sunshine = "numeric",
  WindGustDir = "factor",
  WindGustSpeed = "numeric",
  WindDir9am = "factor",
  WindDir3pm = "factor",
  WindSpeed9am = "numeric",
  WindSpeed3pm = "numeric",
  Humidity9am = "numeric",
  Humidity3pm = "numeric",
  Pressure9am = "numeric",
  Pressure3pm = "numeric",
  Cloud9am = "numeric",
  Cloud3pm = "numeric",
  Temp9am = "numeric",
  Temp3pm = "numeric",
  RainToday = "factor",
  RISK_MM = "numeric",
  RainTomorrow = "factor"
))


# Define levels for categorical columns
wind_dir_levels <- c("N", "NE", "E", "SE", "S", "SW", "W", "NW")
rain_levels <- c("No", "Yes")

# Update factor columns with levels
WeatherData$WindGustDir <- factor(WeatherData$WindGustDir, levels = wind_dir_levels)
WeatherData$WindDir9am <- factor(WeatherData$WindDir9am, levels = wind_dir_levels)
WeatherData$WindDir3pm <- factor(WeatherData$WindDir3pm, levels = wind_dir_levels)
WeatherData$RainToday <- factor(WeatherData$RainToday, levels = rain_levels)
WeatherData$RainTomorrow <- factor(WeatherData$RainTomorrow, levels = rain_levels)

View(WeatherData)

```
## Categorical columns analysis
```{r}
# List of categorical columns in the dataset
categorical_columns <- c("WindGustDir", "WindDir9am", "WindDir3pm", "RainToday", "RainTomorrow")

# Loop through each categorical column and generate frequency and percentage tables
for (col in categorical_columns) {
  column_freq <- table(WeatherData[[col]])
  
  cat(paste("# Number of instances in (", col, "):\n"))
  class_counts <- cbind(frequency = column_freq, percentage = prop.table(column_freq) * 100)
  print(class_counts)
  cat("\n")
}
```
## Measures of Central Tendency

```{r}
# List of numeric columns in the dataset
numeric_columns <- c(
  "MinTemp", "MaxTemp", "Rainfall", "Evaporation", "Sunshine",
  "WindGustSpeed", "WindSpeed9am", "WindSpeed3pm",
  "Humidity9am", "Humidity3pm",
  "Pressure9am", "Pressure3pm",
  "Cloud9am", "Cloud3pm",
  "Temp9am", "Temp3pm",
  "RISK_MM"
)

# Mode function definition
Mode <- function(x) {
  ux <- unique(x)
  ux[which.max(tabulate(match(x, ux)))]
}

# Loop through each numeric column and calculate measures of central tendency
for (col in numeric_columns) {
  cat(paste("# Measures of central tendency for", col, ":\n"))
  
  # Mean
  mean_val <- mean(WeatherData[[col]])
  cat("Mean:", mean_val, "\n")
  
  # Median
  median_val <- median(WeatherData[[col]])
  cat("Median:", median_val, "\n")
  
  # Mode (using the Mode function defined below)
  mode_val <- Mode(WeatherData[[col]])
  cat("Mode:", mode_val, "\n\n")
}

summary(WeatherData)
```
## Measures of Distribution
```{r}
# List of numeric columns in the dataset
numeric_columns <- c(
  "MinTemp", "MaxTemp", "Rainfall", "Evaporation", "Sunshine",
  "WindGustSpeed", "WindSpeed9am", "WindSpeed3pm",
  "Humidity9am", "Humidity3pm",
  "Pressure9am", "Pressure3pm",
  "Cloud9am", "Cloud3pm",
  "Temp9am", "Temp3pm",
  "RISK_MM"
)

# Loop through each numeric column and calculate measures of distribution
for (col in numeric_columns) {
  cat(paste("# Measures of Distribution for", col, ":\n"))
  
  # Range
  range_val <- range(WeatherData[[col]])
  cat("Range:", range_val, "\n")
  
  # Variance
  var_val <- var(WeatherData[[col]])
  cat("Variance:", var_val, "\n")
  
  # Standard Deviation
  sd_val <- sd(WeatherData[[col]])
  cat("Standard Deviation:", sd_val, "\n")
  
}
```
## Measures of Relationship
```{r}
# List of numeric columns in the dataset
numeric_columns <- c(
  "MinTemp", "MaxTemp", "Rainfall", "Evaporation", "Sunshine",
  "WindGustSpeed", "WindSpeed9am", "WindSpeed3pm",
  "Humidity9am", "Humidity3pm",
  "Pressure9am", "Pressure3pm",
  "Cloud9am", "Cloud3pm",
  "Temp9am", "Temp3pm",
  "RISK_MM"
)

# Loop through pairs of numeric columns and calculate measures of relationship
for (i in 1:(length(numeric_columns) - 1)) {
  for (j in (i + 1):length(numeric_columns)) {
    col1 <- numeric_columns[i]
    col2 <- numeric_columns[j]
    
    cat(paste("# Measures of Relationship between", col1, "and", col2, ":\n"))
    
    # Correlation
    correlation_val <- cor(WeatherData[[col1]], WeatherData[[col2]])
    cat("Correlation:", correlation_val, "\n")
    
    # Covariance
    covariance_val <- cov(WeatherData[[col1]], WeatherData[[col2]])
    cat("Covariance:", covariance_val, "\n\n")
  }
}
```
## ANOVA
```{r}
# ANOVA for a categorical variable (WindGustDir) and a numeric variable (MaxTemp)
anova_result1 <- aov(MaxTemp ~ WindGustDir, data = WeatherData)

# Display the ANOVA result for the first analysis
cat("# ANOVA Result for MaxTemp and WindGustDir:\n")
print(anova_result1)

# ANOVA for another categorical variable (RainTomorrow) and a numeric variable (MaxTemp)
anova_result2 <- aov(MaxTemp ~ RainTomorrow, data = WeatherData)

# Display the ANOVA result for the second analysis
cat("\n# ANOVA Result for MaxTemp and RainTomorrow:\n")
print(anova_result2)

```

## Basic Visualizations
### Univariate plots
```{r}
if (!requireNamespace("ggplot2", quietly = TRUE)) {
  install.packages("ggplot2")
}

library(ggplot2)

# Histogram for a numeric variable (Humidity9am)
ggplot(WeatherData, aes(x = Humidity9am)) +
  geom_histogram(binwidth = 5, fill = "coral", color = "black", alpha = 0.7) +
  labs(title = "Histogram of Humidity9am", x = "Humidity9am", y = "Frequency")

# Histogram  for another numeric variable (WindSpeed3pm)
ggplot(WeatherData, aes(x = WindSpeed3pm)) +
  geom_histogram(binwidth = 5, fill = "lightblue", color = "black", alpha = 0.7) +
  labs(title = "Histogram of WindSpeed3pm", x = "WindSpeed3pm", y = "Frequency")

# Bar plot for a categorical variable (WindGustDir)
ggplot(WeatherData, aes(x = WindGustDir)) +
  geom_bar(fill = "lightgreen", color = "black", alpha = 0.7) +
  labs(title = "Bar Plot of WindGustDir", x = "WindGustDir", y = "Count") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) 

# Bar plot for another categorical variable (RainToday)
ggplot(WeatherData, aes(x = RainToday)) +
  geom_bar(fill = "lightpink", color = "black", alpha = 0.7) +
  labs(title = "Bar Plot of RainToday", x = "RainToday", y = "Count") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

### Multivariate Plots
```{r}
#MultiVariate Plots
# Scatter plot for two numeric variables (MaxTemp vs. Rainfall)
ggplot(WeatherData, aes(x = Rainfall, y = MaxTemp)) +
  geom_point(color = "blue", alpha = 0.7) +
  labs(title = "Scatter Plot of MaxTemp vs. Rainfall", x = "Rainfall", y = "MaxTemp")


# Box plot to compare a numeric variable across different levels of a categorical variable (WindGustDir vs. MaxTemp)
ggplot(WeatherData, aes(x = WindGustDir, y = MaxTemp, fill = WindGustDir)) +
  geom_boxplot() +
  labs(title = "Box Plot of MaxTemp Across WindGustDir", x = "WindGustDir", y = "MaxTemp") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) 

# Violin plot for the distribution of a numeric variable across different levels of a categorical variable (e.g., RainToday vs. Humidity9am)
ggplot(WeatherData, aes(x = RainToday, y = Humidity9am, fill = RainToday)) +
  geom_violin() +
  labs(title = "Violin Plot of Humidity9am Across RainToday", x = "RainToday", y = "Humidity9am")

# Bar plot to show the count of occurrences for two categorical variables (WindGustDir and RainToday)
ggplot(WeatherData, aes(x = WindGustDir, fill = RainToday)) +
  geom_bar(position = "dodge") +
  labs(title = "Bar Plot of WindGustDir Counts by RainToday", x = "WindGustDir", y = "Count") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

## Cross-tabulation
# Create a cross-tabulation for RainToday and RainTomorrow
cross_tab <- table(WeatherData$RainToday, WeatherData$RainTomorrow)

# Display the cross-tabulation
print(cross_tab)

# Bar plot for WindGustDir
ggplot(WeatherData, aes(x = WindGustDir, fill = WindGustDir)) +
  geom_bar() +
  labs(title = "Bar Plot of WindGustDir Counts", x = "WindGustDir", y = "Count") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))  # Rotate x-axis labels for better visibility


```


# Preprocessing and Data Transformation
## Missingness
```{r}
# Check for missing values in the entire dataset
missing_values <- any(is.na(WeatherData))

# Display the result
if (missing_values) {
  cat("There are missing values in the dataset.\n")
} else {
  cat("There are no missing values in the dataset.\n")
}
```

## Imputation
```{r}
#install mice package for multiple imputation
# Set a CRAN mirror
options(repos = c(CRAN = "https://cran.rstudio.com"))
install.packages("mice")
library(mice)

# Impute missing values in numeric columns using mean imputation
numeric_cols <- sapply(WeatherData, is.numeric)
imputed_data_numeric <- complete(mice(WeatherData[, numeric_cols]))

# Impute missing values in categorical columns using mode imputation
categorical_cols <- sapply(WeatherData, is.factor)
imputed_data_categorical <- complete(mice(WeatherData[, categorical_cols]))

# Combine the imputed numeric and categorical datasets
imputed_data <- cbind(imputed_data_numeric, imputed_data_categorical)
```

## Check for missing values
```{r}
# Check if there are still missing values in the imputed dataset
missing_values_after_imputation <- any(is.na(imputed_data))

# Display the result
if (missing_values_after_imputation) {
  cat("There are still missing values after imputation.\n")
} else {
  cat("All missing values have been successfully imputed.\n")
}

#replace WeatheData dataset with imputed dataset
# WeatherData <- imputed_data
```

## Standardization of numerical variables for predictions
```{r}
# Standardize the Numeric variables that could be used for prediction
numeric_vars <- c("MaxTemp", "MinTemp", "Rainfall", "Sunshine")

# Standardize the numeric variables
Weather_standardized <- WeatherData
Weather_standardized[numeric_vars] <- scale(WeatherData[numeric_vars])
# Assuming your dataset is already loaded and named "WeatherData"
# Assuming you want to standardize "MaxTemp," "MinTemp," "Rainfall," and "Sunshine"

# Numeric variables to be standardized
numeric_vars <- c("MaxTemp", "MinTemp", "Rainfall", "Sunshine")

# Standardize the numeric variables
Weather_standardized <- WeatherData
Weather_standardized[numeric_vars] <- scale(WeatherData[numeric_vars])

# Load required packages
library(ggplot2)

# Function to create histograms for original MaxTemp and standardized MaxTemp variables
create_histograms <- function(original_data, standardized_data, var) {
  original_plot <- ggplot(original_data, aes(x = !!sym(var))) +
    geom_histogram(binwidth = 1, fill = "blue", color = "black", alpha = 0.7) +
    labs(title = paste("Histogram of Original", var), x = var, y = "Frequency")
  
  standardized_plot <- ggplot(standardized_data, aes(x = !!sym(var))) +
    geom_histogram(binwidth = 0.2, fill = "orange", color = "black", alpha = 0.7) +
    labs(title = paste("Histogram of Standardized", var), x = var, y = "Frequency")
  
  return(list(original_plot = original_plot, standardized_plot = standardized_plot))
}

# Create histograms for original and standardized variables
histograms <- create_histograms(WeatherData, Weather_standardized, numeric_vars[1])

# Display the histograms separately
original_plot <- histograms$original_plot
standardized_plot <- histograms$standardized_plot

print(original_plot)
print(standardized_plot)
```

# Hyper-Parameter Tuning and Ensembles
## Cross-validation
```{r}
library(caret)
library(randomForest)

# Assuming "RainTomorrow" is the target variable
target_variable <- "RainTomorrow"

# Features
features <- c("MinTemp", "MaxTemp", "Rainfall", "Evaporation", "Sunshine", "WindGustSpeed", "Humidity9am", "Humidity3pm")

# Create a control object for cross-validation
cv_control <- trainControl(method = "cv", number = 5)
```

## Grid Search
```{r}
#replace WeatherData dataset with imputed dataset
WeatherData <- imputed_data

#Grid Search
rf_model <- train(WeatherData[, features], WeatherData[[target_variable]],
                  method = "rf",
                  trControl = trainControl(method = "cv", number = 5, search = "grid"),  # Specify grid search
                  tuneLength = 9,  # Number of grid points for tuning
                  metric = "Accuracy")  

# Print tuned model details
print(rf_model)
```

## Bagging Ensemble
```{r}
# Bagging Ensemble
bagging_model <- train(WeatherData[, features], WeatherData[[target_variable]],
                       method = "treebag",  # Bagging method
                       trControl = trainControl(method = "cv", number = 5),
                       metric = "Accuracy")


# Print ensemble model details
print(bagging_model)
```


